<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HarvestAI: Smart Agent</title>
    <style>
        /* --- UI THEME: FUTURE ECO --- */
        :root { --primary: #00ff88; --bg: #0a0a0a; --panel: #141414; --text: #e0e0e0; }
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background-color: var(--bg); color: var(--text); margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        
        /* HUD HEADER */
        .hud-header { 
            width: 100%; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(20, 20, 20, 0.8); border-bottom: 1px solid #333; backdrop-filter: blur(10px);
        }
        .brand { font-size: 1.5rem; font-weight: bold; color: var(--primary); letter-spacing: 2px; }
        .stats { display: flex; gap: 20px; font-size: 0.9rem; }
        .stat-box b { color: var(--primary); font-size: 1.1rem; }

        /* MAIN CONTENT */
        .container { display: flex; flex-wrap: wrap; gap: 30px; padding: 30px; justify-content: center; width: 100%; max-width: 1200px; }

        /* CAMERA PANEL */
        .cam-panel { flex: 1; min-width: 320px; max-width: 500px; display: flex; flex-direction: column; gap: 15px; }
        #webcam-container { 
            width: 100%; aspect-ratio: 1; background: #000; border-radius: 20px; 
            border: 2px solid #333; overflow: hidden; position: relative;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.1);
        }
        .cam-controls { display: flex; gap: 10px; }
        .btn { 
            flex: 1; padding: 15px; border: none; border-radius: 10px; cursor: pointer; 
            font-weight: bold; font-size: 1rem; transition: 0.2s;
        }
        .btn-start { background: var(--primary); color: #000; }
        .btn-stop { background: #ff4444; color: white; opacity: 0.5; pointer-events: none; }
        .active .btn-stop { opacity: 1; pointer-events: all; }
        .active .btn-start { opacity: 0.5; pointer-events: none; }

        /* AGENT PANEL */
        .agent-panel { 
            flex: 1; min-width: 320px; background: var(--panel); border-radius: 20px; padding: 25px;
            border: 1px solid #333; display: flex; flex-direction: column; gap: 20px;
            min-height: 450px;
        }
        .agent-title { font-size: 1.8rem; border-bottom: 1px solid #333; padding-bottom: 15px; color: var(--primary); }
        .info-group { opacity: 0; transform: translateY(10px); transition: 0.5s all; }
        .visible { opacity: 1; transform: translateY(0); }
        
        .label { font-size: 0.75rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: block; }
        .text-content { font-size: 1rem; line-height: 1.5; color: #ccc; margin-bottom: 15px; }
        
        /* INTERNET SEARCH BUTTONS */
        .web-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: auto; }
        .btn-web { 
            background: #222; color: white; padding: 12px; border: 1px solid #444; border-radius: 8px; cursor: pointer; text-align: left;
        }
        .btn-web:hover { border-color: var(--primary); background: #2a2a2a; }
        .btn-web span { font-size: 0.7rem; color: #888; display: block; }

    </style>
</head>
<body>

    <div class="hud-header">
        <div class="brand">HarvestAI <span style="font-size:0.6em; opacity:0.6;">V3.0</span></div>
        <div class="stats">
            <div class="stat-box">COMPONENTS RESCUED: <b id="count">0</b></div>
            <div class="stat-box">CO‚ÇÇ PREVENTED: <b id="co2">0g</b></div>
        </div>
    </div>

    <div class="container">
        
        <div class="cam-panel" id="cam-panel">
            <div id="webcam-container"></div>
            <div class="cam-controls">
                <button class="btn btn-start" onclick="init()">‚ñ∂ START CAMERA</button>
                <button class="btn btn-stop" onclick="stopCamera()">‚èπ STOP CAMERA</button>
            </div>
            <input type="text" id="manual-input" placeholder="Or type component name..." 
                   style="padding:15px; background:#111; border:1px solid #333; color:white; border-radius:10px;"
                   onkeypress="if(event.key==='Enter') manualSearch()">
        </div>

        <div class="agent-panel">
            <div class="agent-title" id="part-name">Waiting for Input...</div>
            
            <div id="agent-body">
                <div class="info-group" id="info-safety">
                    <span class="label">AI Safety Analysis</span>
                    <div class="text-content" id="safety-text">--</div>
                </div>

                <div class="info-group" id="info-desc">
                    <span class="label">Live Knowledge (Wikipedia)</span>
                    <div class="text-content" id="wiki-text">--</div>
                </div>

                <div class="web-actions" id="web-btns" style="opacity:0.5; pointer-events:none;">
                    <button class="btn-web" onclick="searchWeb('project')">
                        <span>FIND IMPROVEMENTS</span>
                        <b>üí° New Projects (2026)</b>
                    </button>
                    <button class="btn-web" onclick="searchWeb('datasheet')">
                        <span>TECHNICAL SPECS</span>
                        <b>üìÑ Datasheet & Pinout</b>
                    </button>
                    <button class="btn-web" onclick="searchWeb('recycle')">
                        <span>RESPONSIBLE DISPOSAL</span>
                        <b>‚ôªÔ∏è Recycling Map</b>
                    </button>
                    <button class="btn-web" onclick="searchWeb('shop')">
                        <span>MISSING PARTS?</span>
                        <b>üõí Buy Accessories</b>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script>
        
        // üî¥ PASTE YOUR TEACHABLE MACHINE URL HERE
        const URL = "https://teachablemachine.withgoogle.com/models/YOUR_MODEL_ID_HERE/";

        let model, webcam, maxPredictions, isRunning = false;
        let lastDetected = "";
        let currentPart = "";
        let totalCount = 0;
        let totalCO2 = 0;
        let loopId;

        // --- CAMERA CONTROL ---
        async function init() {
            if(isRunning) return;
            
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            try {
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                const flip = true; 
                webcam = new tmImage.Webcam(400, 400, flip); 
                await webcam.setup(); 
                await webcam.play();
                
                // Clear old canvas if exists
                const container = document.getElementById("webcam-container");
                container.innerHTML = "";
                container.appendChild(webcam.canvas);

                loop();
                isRunning = true;
                document.getElementById("cam-panel").classList.add("active");
            } catch (e) {
                alert("Error: Check your Model URL!");
            }
        }

        function stopCamera() {
            if(webcam && isRunning) {
                webcam.stop();
                cancelAnimationFrame(loopId);
                isRunning = false;
                document.getElementById("cam-panel").classList.remove("active");
                document.getElementById("webcam-container").innerHTML = "<div style='display:flex;align-items:center;justify-content:center;height:100%;color:#555;'>CAMERA STOPPED</div>";
            }
        }

        async function loop() {
            if(!isRunning) return;
            webcam.update(); 
            await predict();
            loopId = requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            let highestProb = 0;
            let bestClass = "";

            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > highestProb) {
                    highestProb = prediction[i].probability;
                    bestClass = prediction[i].className;
                }
            }

            if (highestProb > 0.95 && bestClass !== "Background" && bestClass !== lastDetected) {
                lastDetected = bestClass;
                triggerAgent(bestClass);
                
                // Update Stats
                totalCount++;
                totalCO2 += 150; // Approx 150g CO2 saved per electronic reused
                document.getElementById("count").innerText = totalCount;
                document.getElementById("co2").innerText = totalCO2 + "g";
                
                // Reset detection lock
                setTimeout(() => { lastDetected = ""; }, 4000);
            }
        }

        // --- AGENT LOGIC ---
        function manualSearch() {
            const val = document.getElementById("manual-input").value;
            if(val) triggerAgent(val);
        }

        async function triggerAgent(partName) {
            currentPart = partName;
            document.getElementById("part-name").innerText = partName;
            
            // 1. Safety Logic
            let safety = "‚úÖ Safe to handle. Standard e-waste protocols apply.";
            if(partName.toLowerCase().includes("battery")) safety = "‚ö†Ô∏è FIRE RISK: Do not puncture. Tape terminals.";
            if(partName.toLowerCase().includes("capacitor")) safety = "‚ö° SHOCK RISK: Discharge before handling.";
            document.getElementById("safety-text").innerText = safety;

            // 2. Wikipedia API (The "Internet" Search)
            document.getElementById("wiki-text").innerText = "Fetching live definition...";
            try {
                const res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${partName}`);
                const data = await res.json();
                document.getElementById("wiki-text").innerText = data.extract || "No specific wiki definition found. Try the web buttons below.";
            } catch(e) {
                document.getElementById("wiki-text").innerText = "Offline mode.";
            }

            // 3. Enable Internet Buttons
            document.getElementById("web-btns").style.opacity = "1";
            document.getElementById("web-btns").style.pointerEvents = "all";
            
            // 4. Voice
            speak(partName + " detected.");
            
            // 5. Auto-reveal animations
            document.querySelectorAll(".info-group").forEach(el => el.classList.add("visible"));
        }

        // --- INTERNET SEARCH ACTIONS ---
        function searchWeb(type) {
            if(!currentPart) return;
            let url = "";
            switch(type) {
                case 'project': // "Go through internet for improvements"
                    url = `https://www.google.com/search?q=advanced+projects+using+${currentPart}+2026+upcycling+ideas`;
                    break;
                case 'datasheet':
                    url = `https://www.google.com/search?q=${currentPart}+datasheet+pinout+pdf`;
                    break;
                case 'recycle': // "More improvements" -> Sustainability
                    url = `https://www.google.com/maps/search/e-waste+recycling+centers+near+me`;
                    break;
                case 'shop':
                    url = `https://www.google.com/search?q=buy+accessories+for+${currentPart}`;
                    break;
            }
            window.open(url, '_blank');
        }

        function speak(text) {
            if('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(text);
                window.speechSynthesis.speak(u);
            }
        }

    </script>
</body>
</html>
